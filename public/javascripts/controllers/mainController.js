 var geo = 
 [{"id": "1", "long": "-1.3960704", "lat": "50.9376734"}, {"id": "2", "long": "-1.3981275", "lat": "50.9362789"}, {"id": "2A", "long": "-1.3975235", "lat": "50.9364286"}, {"id": "4", "long": "-1.3977134", "lat": "50.9360909"}, {"id": "5", "long": "-1.3948313", "lat": "50.9355883"}, {"id": "6", "long": "-1.3972189", "lat": "50.9359585"}, {"id": "7", "long": "-1.3940282", "lat": "50.9353558"}, {"id": "8", "long": "-1.3947926", "lat": "50.936537"}, {"id": "9", "long": "-1.394215", "lat": "50.9355501"}, {"id": "13", "long": "-1.393488", "lat": "50.935551"}, {"id": "15", "long": "-1.3933722", "lat": "50.9358355"}, {"id": "16", "long": "-1.3956608", "lat": "50.9376285"}, {"id": "17", "long": "-1.3946145", "lat": "50.9362396"}, {"id": "18", "long": "-1.3966792", "lat": "50.9338813"}, {"id": "19", "long": "-1.392867", "lat": "50.9355444"}, {"id": "20", "long": "-1.3951265", "lat": "50.9368962"}, {"id": "21", "long": "-1.3932157", "lat": "50.9351646"}, {"id": "22", "long": "-1.3941636", "lat": "50.9350233"}, {"id": "25", "long": "-1.3934585", "lat": "50.9347702"}, {"id": "26", "long": "-1.3941216", "lat": "50.9347143"}, {"id": "27", "long": "-1.393776", "lat": "50.93432"}, {"id": "28", "long": "-1.3945278", "lat": "50.9346967"}, {"id": "29", "long": "-1.3939798", "lat": "50.9340008"}, {"id": "30", "long": "-1.3944765", "lat": "50.9343082"}, {"id": "32", "long": "-1.395905", "lat": "50.9364157"}, {"id": "34", "long": "-1.395317", "lat": "50.9344936"}, {"id": "35", "long": "-1.394475", "lat": "50.93383"}, {"id": "36", "long": "-1.395156", "lat": "50.934986"}, {"id": "37", "long": "-1.395696", "lat": "50.934147"}, {"id": "38", "long": "-1.3974278", "lat": "50.9354059"}, {"id": "39", "long": "-1.399298", "lat": "50.936722"}, {"id": "40", "long": "-1.3973325", "lat": "50.9347275"}, {"id": "41", "long": "-1.395301", "lat": "50.933559"}, {"id": "42", "long": "-1.397511", "lat": "50.934219"}, {"id": "44", "long": "-1.399062", "lat": "50.934322"}, {"id": "45", "long": "-1.394014", "lat": "50.937801"}, {"id": "46", "long": "-1.3996014", "lat": "50.9348505"}, {"id": "48", "long": "-1.399485", "lat": "50.935696"}, {"id": "50", "long": "-1.3994", "lat": "50.936142"}, {"id": "52", "long": "-1.3988324", "lat": "50.9358682"}, {"id": "53", "long": "-1.398236", "lat": "50.937412"}, {"id": "54", "long": "-1.3988756", "lat": "50.9362228"}, {"id": "57", "long": "-1.396755", "lat": "50.934399"}, {"id": "58", "long": "-1.398697", "lat": "50.936592"}, {"id": "59", "long": "-1.3977863", "lat": "50.9374063"}, {"id": "60", "long": "-1.3975471", "lat": "50.93774"}, {"id": "62", "long": "-1.4049952", "lat": "50.9372304"}, {"id": "65", "long": "-1.402838", "lat": "50.929203"}, {"id": "67", "long": "-1.3966181", "lat": "50.9366885"}, {"id": "68", "long": "-1.394491", "lat": "50.892773"}, {"id": "77", "long": "-1.4068368", "lat": "50.920439"}, {"id": "85", "long": "-1.395323", "lat": "50.936436"}, {"id": "86", "long": "-1.396765", "lat": "50.93739"}, {"id": "92", "long": "-1.4255025", "lat": "50.9621255"}, {"id": "93", "long": "-1.363412", "lat": "50.952282"}, {"id": "96", "long": "-1.4233506", "lat": "50.9619135"}, {"id": "97", "long": "-1.4250697", "lat": "50.9609746"}, {"id": "99", "long": "-1.4226617", "lat": "50.961019"}, {"id": "115", "long": "-1.397173", "lat": "50.936291"}, {"id": "123", "long": "-1.396685", "lat": "50.898575"}, {"id": "146", "long": "-1.409098245", "lat": "50.90863559"}, {"id": "147", "long": "-1.409657827", "lat": "50.9083573"}, {"id": "148", "long": "-1.40964574", "lat": "50.90871149"}, {"id": "150", "long": "-1.3840867", "lat": "50.9307365"}, {"id": "151", "long": "-1.3838409", "lat": "50.9311694"}, {"id": "152", "long": "-1.3838018", "lat": "50.9312434"}, {"id": "165", "long": "-1.3907767", "lat": "50.9284882"}, {"id": "166", "long": "-1.082381", "lat": "50.789497"}, {"id": "168", "long": "-1.378118044", "lat": "50.93991462"}, {"id": "169", "long": "-1.378284082", "lat": "50.94007008"}, {"id": "170", "long": "-1.378037521", "lat": "50.94016377"}, {"id": "171", "long": "-1.378118044", "lat": "50.93991462"}, {"id": "177", "long": "-1.403968153", "lat": "50.93696999"}, {"id": "185", "long": "50.93782091", "lat": "-1.404858637"}, {"id": "186", "long": "-1.4061021", "lat": "50.93755118"}, {"id": "1050", "long": "-1.395323", "lat": "50.933235"}, {"id": "1051", "long": "-1.395356", "lat": "50.933338"}, {"id": "1101", "long": "-1.3959296", "lat": "50.9330414"}, {"id": "1102", "long": "-1.3960392", "lat": "50.9333389"}, {"id": "1104", "long": "-1.396101", "lat": "50.9334345"}, {"id": "1105", "long": "-1.3961544", "lat": "50.933516"}, {"id": "1106", "long": "-1.3962246", "lat": "50.9335868"}, {"id": "1107", "long": "-1.3962471", "lat": "50.9336275"}, {"id": "1220", "long": "-1.395103", "lat": "50.938011"}, {"id": "1221", "long": "-1.395002", "lat": "50.938026"}, {"id": "1222", "long": "-1.39495", "lat": "50.938034"}, {"id": "1390", "long": "-1.400937", "lat": "50.933636"}, {"id": "1391", "long": "-1.400937", "lat": "50.933636"}, {"id": "1395", "long": "-1.4037955", "lat": "50.9381522"}, {"id": "1401", "long": "-1.3979365", "lat": "50.9330741"}, {"id": "1402", "long": "-1.3979888", "lat": "50.933101"}, {"id": "1403", "long": "-1.3980886", "lat": "50.9331489"}, {"id": "1404", "long": "-1.3981409", "lat": "50.9331759"}, {"id": "1405", "long": "-1.3982264", "lat": "50.9332298"}, {"id": "1406", "long": "-1.3982834", "lat": "50.9332568"}, {"id": "1407", "long": "-1.398388", "lat": "50.9333077"}, {"id": "1408", "long": "-1.3984498", "lat": "50.9333406"}, {"id": "1409", "long": "-1.3985496", "lat": "50.9333886"}, {"id": "1410", "long": "-1.3986066", "lat": "50.9334155"}, {"id": "1411", "long": "-1.398716", "lat": "50.9334605"}, {"id": "1412", "long": "-1.3987777", "lat": "50.9334904"}, {"id": "1413", "long": "-1.3990059", "lat": "50.9336012"}, {"id": "1414", "long": "-1.3990629", "lat": "50.9336342"}, {"id": "1415", "long": "-1.3991675", "lat": "50.9336731"}, {"id": "1416", "long": "-1.3992198", "lat": "50.9337061"}, {"id": "1417", "long": "-1.3993291", "lat": "50.933742"}, {"id": "1418", "long": "-1.3993814", "lat": "50.933772"}, {"id": "1419", "long": "-1.3994954", "lat": "50.9338139"}, {"id": "1420", "long": "-1.3995477", "lat": "50.9338439"}, {"id": "1421", "long": "-1.3997949", "lat": "50.9339487"}, {"id": "1422", "long": "-1.3998519", "lat": "50.9339817"}, {"id": "1423", "long": "-1.3999612", "lat": "50.9340266"}, {"id": "1424", "long": "-1.4000135", "lat": "50.9340535"}, {"id": "1425", "long": "-1.4001038", "lat": "50.9341015"}, {"id": "1426", "long": "-1.4001608", "lat": "50.9341314"}, {"id": "1501", "long": "-1.393987", "lat": "50.933098"}, {"id": "1502", "long": "-1.393974", "lat": "50.933182"}, {"id": "1503", "long": "-1.393982", "lat": "50.93327"}, {"id": "1504", "long": "-1.393979", "lat": "50.933353"}, {"id": "1505", "long": "-1.393965", "lat": "50.933445"}, {"id": "1506", "long": "-1.393944", "lat": "50.933529"}, {"id": "1507", "long": "-1.393915", "lat": "50.933605"}, {"id": "1508", "long": "-1.393915", "lat": "50.933701"}, {"id": "1580", "long": "-1.401279", "lat": "50.928944"}, {"id": "1601", "long": "-1.3925923", "lat": "50.9350404"}, {"id": "1602", "long": "-1.3926691", "lat": "50.9350607"}, {"id": "1603", "long": "-1.4032566", "lat": "50.9380349"}, {"id": "1604", "long": "-1.4039043", "lat": "50.9425216"}, {"id": "1610", "long": "-1.37853", "lat": "50.936123"}, {"id": "1612", "long": "-1.380123", "lat": "50.934734"}, {"id": "1622", "long": "-1.390499", "lat": "50.936714"}, {"id": "1630", "long": "-1.393715", "lat": "50.9369467"}, {"id": "1640", "long": "-1.398211", "lat": "50.929989"}, {"id": "1710", "long": "-1.4032158", "lat": "50.9421475"}, {"id": "1730", "long": "-1.3001172", "lat": "51.0686667"}, {"id": "9001", "long": "-1.363689", "lat": "50.951485"}, {"id": "9004", "long": "-1.363506", "lat": "50.951576"}, {"id": "9011", "long": "-1.365365", "lat": "50.950558"}, {"id": "9012", "long": "-1.365365", "lat": "50.950558"}, {"id": "9014", "long": "-1.39509", "lat": "50.9333"}, {"id": "9500", "long": "-1.436441", "lat": "50.932362"}, {"id": "9510", "long": "-1.435797", "lat": "50.932819"}, {"id": "9520", "long": "-1.435561", "lat": "50.933701"}, {"id": "9530", "long": "-1.434392", "lat": "50.933247"}, {"id": "9540", "long": "-1.43714396", "lat": "50.93266106"}, {"id": "9550", "long": "-1.434907", "lat": "50.935337"}, {"id": "9555", "long": "-1.434091664", "lat": "50.93406646"}, {"id": "9580", "long": "-1.433555", "lat": "50.934307"}, {"id": "9585", "long": "-1.3973994", "lat": "50.9125279"}, {"id": "9590", "long": "-1.427804", "lat": "50.940327"}, {"id": "9591", "long": "-1.110778", "lat": "51.279823"}, {"id": "9592", "long": "-1.330204", "lat": "51.061089"}, {"id": "9593", "long": "-1.065159", "lat": "50.800404"}, {"id": "9594", "long": "-1.300592", "lat": "50.711353"}, {"id": "9595", "long": "-1.082381", "lat": "50.789497"}, {"id": "37A", "long": "-1.395687", "lat": "50.933811"}, {"id": "58A", "long": "-1.3980786", "lat": "50.9367447"}, {"id": "63A", "long": "-1.3088779", "lat": "51.0657027"}, {"id": "63C", "long": "-1.3087201", "lat": "51.065325"}, {"id": "63F", "long": "-1.3097192", "lat": "51.0656271"}, {"id": "63G", "long": "-1.3098995", "lat": "51.0653675"}, {"id": "63K", "long": "-1.310366", "lat": "51.066025"}, {"id": "63L", "long": "-1.3102375", "lat": "51.066373"}, {"id": "65A", "long": "-1.403128", "lat": "50.928783"}, {"id": "65B", "long": "-1.4036629", "lat": "50.9288317"}, {"id": "70A", "long": "-1.4031107", "lat": "50.941608"}, {"id": "70AA", "long": "-1.4025225", "lat": "50.9415981"}, {"id": "70B", "long": "-1.4032631", "lat": "50.9412373"}, {"id": "70BB", "long": "-1.401953", "lat": "50.941452"}, {"id": "70C", "long": "-1.403592", "lat": "50.941536"}, {"id": "70CC", "long": "-1.4024437", "lat": "50.9412837"}, {"id": "70D", "long": "-1.4032263", "lat": "50.941843"}, {"id": "70E", "long": "-1.4034784", "lat": "50.9420383"}, {"id": "72A1-A", "long": "-1.374458", "lat": "50.937782"}, {"id": "72A1-B", "long": "-1.374393", "lat": "50.937683"}, {"id": "72A1-C", "long": "-1.374334", "lat": "50.937595"}, {"id": "72A2-D", "long": "-1.37445", "lat": "50.937393"}, {"id": "72A2-E", "long": "-1.37467", "lat": "50.937344"}, {"id": "72A2-F", "long": "-1.374884", "lat": "50.937279"}, {"id": "72A2-G", "long": "-1.375187", "lat": "50.937355"}, {"id": "72A2-H", "long": "-1.375257", "lat": "50.937454"}, {"id": "72A2-J", "long": "-1.375327", "lat": "50.937561"}, {"id": "72A2-K", "long": "-1.374989", "lat": "50.937805"}, {"id": "72A2-L", "long": "-1.375083", "lat": "50.937973"}, {"id": "72C", "long": "-1.375367", "lat": "50.93819"}, {"id": "72D-M", "long": "-1.37549", "lat": "50.938461"}, {"id": "72D-N", "long": "-1.375209", "lat": "50.938553"}, {"id": "72D-P", "long": "-1.374951", "lat": "50.938625"}, {"id": "72E-Q", "long": "-1.374581", "lat": "50.938484"}, {"id": "72E-R", "long": "-1.374367", "lat": "50.938183"}, {"id": "72F-S", "long": "-1.375544", "lat": "50.938591"}, {"id": "72G", "long": "-1.374106", "lat": "50.937477"}, {"id": "73A", "long": "-1.4029587", "lat": "50.943379"}, {"id": "73B", "long": "-1.4032985", "lat": "50.9434045"}, {"id": "73B1", "long": "-1.400848", "lat": "50.94405"}, {"id": "73B2", "long": "-1.400848", "lat": "50.94405"}, {"id": "73B3", "long": "-1.400848", "lat": "50.94405"}, {"id": "73B4", "long": "-1.400848", "lat": "50.94405"}, {"id": "73C", "long": "-1.4032123", "lat": "50.9436282"}, {"id": "73D", "long": "-1.4024566", "lat": "50.9439382"}, {"id": "73E", "long": "-1.4021067", "lat": "50.9438934"}, {"id": "73F", "long": "-1.402203", "lat": "50.9436793"}, {"id": "73G", "long": "-1.4018785", "lat": "50.9436666"}, {"id": "73H", "long": "-1.4020052", "lat": "50.9441011"}, {"id": "73J", "long": "-1.401488", "lat": "50.943919"}, {"id": "73K", "long": "-1.4009757", "lat": "50.9432479"}, {"id": "73L", "long": "-1.4006309", "lat": "50.9437049"}, {"id": "73M", "long": "-1.3998397", "lat": "50.9437017"}, {"id": "73N-A", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-B", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-C", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-D", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-E", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-F", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-G", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-H", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-J", "long": "-1.402854", "lat": "50.94236"}, {"id": "73N-K", "long": "-1.402854", "lat": "50.94236"}, {"id": "73Q1", "long": "-1.402873", "lat": "50.943848"}, {"id": "73Q2", "long": "-1.402873", "lat": "50.943848"}, {"id": "73R", "long": "-1.404631", "lat": "50.9434354"}, {"id": "73S", "long": "-1.401352", "lat": "50.944126"}, {"id": "73T", "long": "-1.3994289", "lat": "50.9431457"}, {"id": "73W", "long": "-1.4031058", "lat": "50.9431776"}, {"id": "73X-Q", "long": "-1.4026798", "lat": "50.9429667"}, {"id": "73X-R", "long": "-1.4023501", "lat": "50.9429188"}, {"id": "73X-S", "long": "-1.4021625", "lat": "50.9427239"}, {"id": "73X-T", "long": "-1.4022081", "lat": "50.9424938"}, {"id": "75A", "long": "-1.4018216", "lat": "50.9298947"}, {"id": "75C", "long": "-1.402665", "lat": "50.9301743"}, {"id": "76A", "long": "-1.3784044", "lat": "50.937321"}, {"id": "76B", "long": "-1.3778009", "lat": "50.9376576"}, {"id": "76C", "long": "-1.377127", "lat": "50.937645"}, {"id": "76D", "long": "-1.376708", "lat": "50.937752"}, {"id": "76E", "long": "-1.376204", "lat": "50.937859"}, {"id": "76F", "long": "-1.37733", "lat": "50.938011"}, {"id": "76G", "long": "-1.376933", "lat": "50.938107"}, {"id": "76H", "long": "-1.376402", "lat": "50.938232"}, {"id": "76J", "long": "-1.377561", "lat": "50.938339"}, {"id": "76K", "long": "-1.376944", "lat": "50.938484"}, {"id": "76L", "long": "-1.376306", "lat": "50.938629"}, {"id": "76M", "long": "-1.377389", "lat": "50.938606"}, {"id": "76N", "long": "-1.376751", "lat": "50.938763"}, {"id": "76P", "long": "-1.377196", "lat": "50.938877"}, {"id": "76Q", "long": "-1.376536", "lat": "50.939026"}, {"id": "76R", "long": "-1.376976", "lat": "50.939156"}, {"id": "76S", "long": "-1.376349", "lat": "50.939289"}, {"id": "76SC", "long": "-1.3780581", "lat": "50.9380566"}, {"id": "76T", "long": "-1.376783", "lat": "50.939426"}, {"id": "76U", "long": "-1.3780779", "lat": "50.9383121"}, {"id": "76V", "long": "-1.3781373", "lat": "50.937561"}, {"id": "76W", "long": "-1.3779839", "lat": "50.9372773"}, {"id": "76X", "long": "-1.3784588", "lat": "50.9370062"}, {"id": "76Z", "long": "-1.376976", "lat": "50.937473"}, {"id": "78A", "long": "-1.376944", "lat": "50.936687"}, {"id": "78B", "long": "-1.377465", "lat": "50.936699"}, {"id": "78C", "long": "-1.377534", "lat": "50.936543"}, {"id": "78E", "long": "-1.3759936", "lat": "50.9373466"}, {"id": "79A", "long": "-1.402425", "lat": "50.940872"}, {"id": "79B", "long": "-1.401899", "lat": "50.940411"}, {"id": "79C", "long": "-1.401371", "lat": "50.940643"}, {"id": "81A", "long": "-1.3907157", "lat": "50.945967"}, {"id": "81B", "long": "-1.3904644", "lat": "50.9458051"}, {"id": "81C", "long": "-1.390787", "lat": "50.945606"}, {"id": "81D", "long": "-1.3909756", "lat": "50.9458246"}, {"id": "81E", "long": "-1.3911761", "lat": "50.9456236"}, {"id": "82A", "long": "-1.4077298", "lat": "50.9169714"}, {"id": "82B", "long": "-1.4098021", "lat": "50.9157541"}, {"id": "94A", "long": "-1.380039", "lat": "50.934563"}, {"id": "94B", "long": "-1.380039", "lat": "50.934563"}, {"id": "94C", "long": "-1.3807397", "lat": "50.9337771"}, {"id": "94F", "long": "-1.380549", "lat": "50.934185"}, {"id": "94G", "long": "-1.380509", "lat": "50.934058"}, {"id": "94H", "long": "-1.380648", "lat": "50.934078"}, {"id": "193", "long": "103.61218", "lat": "1.42987"}];

 var entrances = [{"Access_Method_Daytime": "Open", "Longitude": "-1.39594", "Building_ID": "32", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93606", "Access_Method_Night": "Buzzer, Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner, Buzzer"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39574", "Building_ID": "32", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93641", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39561", "Building_ID": "85", "Opening_Method": "Sensor + Automatic", "Latitude": "50.9364", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39505", "Building_ID": "85", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93616", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner, Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39607", "Building_ID": "32", "Opening_Method": "Sensor + Automatic", "Latitude": "50.9368", "Access_Method_Night": "Key", "Entrance_ID": "C", "Access_Method_Evening": "Card scanner, Buzzer"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39648", "Building_ID": "67", "Opening_Method": "Pushbutton + Automatic, Revolving", "Latitude": "50.93674", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner, Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39745", "Building_ID": "6", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93613", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39755", "Building_ID": "6", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93596", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Card scanner, Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39778", "Building_ID": "4", "Opening_Method": "Pushbutton + Automatic", "Latitude": "50.93581", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39786", "Building_ID": "6", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93612", "Access_Method_Night": "Open", "Entrance_ID": "C", "Access_Method_Evening": "Open"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39772", "Building_ID": "2A", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93642", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39741", "Building_ID": "2A", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93632", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Open"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39787", "Building_ID": "2", "Opening_Method": "Pushbutton + Automatic, Sensor + Automatic", "Latitude": "50.93645", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39818", "Building_ID": "2", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93602", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39822", "Building_ID": "2", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93582", "Access_Method_Night": "Key", "Entrance_ID": "C", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39895", "Building_ID": "58", "Opening_Method": "Pushbutton + Automatic, Sensor + Automatic", "Latitude": "50.9365", "Access_Method_Night": "Card scanner", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39849", "Building_ID": "58", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93676", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39902", "Building_ID": "58", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93666", "Access_Method_Night": "Key", "Entrance_ID": "C", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39834", "Building_ID": "58", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93645", "Access_Method_Night": "Card scanner", "Entrance_ID": "D", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39899", "Building_ID": "54", "Opening_Method": "Sensor + Automatic", "Latitude": "50.9363", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39791", "Building_ID": "58A", "Opening_Method": "Pushbutton + Automatic, Revolving", "Latitude": "50.93688", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39805", "Building_ID": "53", "Opening_Method": "Pushbutton + Automatic, Revolving", "Latitude": "50.93743", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Card scanner", "Longitude": "-1.39799", "Building_ID": "53", "Opening_Method": "Pushbutton + Automatic", "Latitude": "50.93755", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "Card scanner", "Longitude": "-1.39771", "Building_ID": "59", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93713", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "", "Longitude": "", "Building_ID": "70AA", "Opening_Method": "", "Latitude": "", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "", "Building_ID": "70BB", "Opening_Method": "", "Latitude": "", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "", "Building_ID": "77CC", "Opening_Method": "", "Latitude": "", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "", "Building_ID": "70CC", "Opening_Method": "", "Latitude": "", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39741", "Building_ID": "42", "Opening_Method": "Sensor + Automatic", "Latitude": "50.93443", "Access_Method_Night": "Key", "Entrance_ID": "A", "Access_Method_Evening": "Open"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39724", "Building_ID": "42", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93443", "Access_Method_Night": "Key", "Entrance_ID": "B", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39696", "Building_ID": "42", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93435", "Access_Method_Night": "Key", "Entrance_ID": "C", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39758", "Building_ID": "42", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93453", "Access_Method_Night": "Key", "Entrance_ID": "D", "Access_Method_Evening": "Open"}, {"Access_Method_Daytime": "Open", "Longitude": "-1.39856", "Building_ID": "44", "Opening_Method": "Manual - Push/Pull", "Latitude": "50.93449", "Access_Method_Night": "Card scanner", "Entrance_ID": "E", "Access_Method_Evening": "Card scanner"}, {"Access_Method_Daytime": "", "Longitude": "-1.3989207", "Building_ID": "44", "Opening_Method": "", "Latitude": "50.9342219", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39915", "Building_ID": "44", "Opening_Method": "", "Latitude": "50.9347", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.398864", "Building_ID": "44", "Opening_Method": "", "Latitude": "50.9348239", "Access_Method_Night": "", "Entrance_ID": "C", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39865", "Building_ID": "44", "Opening_Method": "", "Latitude": "50.93463", "Access_Method_Night": "", "Entrance_ID": "D", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "Key", "Longitude": "", "Building_ID": "70CC", "Opening_Method": "", "Latitude": "", "Access_Method_Night": "Key", "Entrance_ID": "C", "Access_Method_Evening": "Key"}, {"Access_Method_Daytime": "", "Longitude": "-1.39383", "Building_ID": "29", "Opening_Method": "", "Latitude": "50.93389", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39419", "Building_ID": "29", "Opening_Method": "", "Latitude": "50.934", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39454", "Building_ID": "30", "Opening_Method": "", "Latitude": "50.93413", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39405", "Building_ID": "27", "Opening_Method": "", "Latitude": "50.93433", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.3934", "Building_ID": "27", "Opening_Method": "", "Latitude": "50.9345", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39318", "Building_ID": "25", "Opening_Method": "", "Latitude": "50.93472", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39364", "Building_ID": "25", "Opening_Method": "", "Latitude": "50.93487", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39338", "Building_ID": "25", "Opening_Method": "", "Latitude": "50.93472", "Access_Method_Night": "", "Entrance_ID": "C", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39315", "Building_ID": "25", "Opening_Method": "", "Latitude": "50.9349", "Access_Method_Night": "", "Entrance_ID": "D", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39388", "Building_ID": "7", "Opening_Method": "", "Latitude": "50.93523", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39451", "Building_ID": "7", "Opening_Method": "", "Latitude": "50.93549", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39871", "Building_ID": "54", "Opening_Method": "", "Latitude": "50.93605", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39863", "Building_ID": "56", "Opening_Method": "", "Latitude": "50.93612", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39818", "Building_ID": "60", "Opening_Method": "", "Latitude": "50.93766", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.39695", "Building_ID": "60", "Opening_Method": "", "Latitude": "50.93777", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.40492", "Building_ID": "176", "Opening_Method": "", "Latitude": "50.9368", "Access_Method_Night": "", "Entrance_ID": "A", "Access_Method_Evening": ""}, {"Access_Method_Daytime": "", "Longitude": "-1.40455", "Building_ID": "176", "Opening_Method": "", "Latitude": "50.93684", "Access_Method_Night": "", "Entrance_ID": "B", "Access_Method_Evening": ""}];
 var map;
 var directionsService;
 var polyline;
 var bounds;
 var distanceService;
 var callbackCounter = 0;
 var callbackResponses = 0;
 var callbackMAX = 0;
 var callbackDistances = [];
 // new algorithm
 var nCounter = 0;



 function initMap() {
 	directionsService = new google.maps.DirectionsService();
 	directionsDisplay = new google.maps.DirectionsRenderer();
 	distanceService = new google.maps.DistanceMatrixService();

 	polyline = new google.maps.Polyline({
 		path: [],
 		strokeColor: '#FF0000',
 		strokeWeight: 3
 	});
 	bounds = new google.maps.LatLngBounds();

 	map = new google.maps.Map(document.getElementById('map'), {
 		center: {lat: 50.935742, lng: -1.3988268},
 		zoom: 17,
 		zoomControl: true,
 		scaleControl: true
 	});


	geo.forEach(function(building){
	//console.log(building);
	var myLatLng = {lat: Number(building.lat), lng:Number(building.long)};
	var contentString = "<h6>" + building.id + "</h6>";
	var infowindow = new google.maps.InfoWindow({
		content: contentString
	});

	var marker = new google.maps.Marker({
		position: myLatLng,
		map: map,
		title: building.id
	});

	marker.addListener('click', function() {
		infowindow.open(map, marker);
	});
	});

 	// this is markers for the entrances 
 	entrances.forEach(function(entrance){
 		var entranceMarker = new google.maps.Marker({
 			position: {
 				lat: Number(entrance.Latitude), lng: Number(entrance.Longitude)
 			},
 			map:map,
 			title: entrance.Entrance_ID
 		});

 		var entranceContent = "<h6>Entrance " + entrance.Entrance_ID + " for <br/>building " + entrance.Building_ID;
 		var infowindow = new google.maps.InfoWindow({
 			content:entranceContent
 		});

 		entranceMarker.addListener('click', function(){
 			infowindow.open(map, entranceMarker);
 		});
 	});


 	// end of entrances
 }




 function route()
 {
 	var textA = Number($('#textA').val());
 	var textB = Number($('#textB').val());
	// console.log(textA);
	// console.log(textB)
	var locA;
	var locB;
	geo.forEach(function(loc){
		var theid = Number(loc.id);
		if(theid == textA){
			locA = loc;
		//console.log(locA);
			}

		if(theid == textB){
			locB = loc;
		//console.log(locA);
		}
	});

	calcRoute(locA, locB);
}


// END
//calcRoute(locA, locB);


function calcRoute(locA, locB) {
	// array to store entrances for a target building
	var currentBuildingEntrances = [];
	entrances.forEach(function(en){
		if (en.Building_ID == locB.id){
			currentBuildingEntrances.push({lat: Number(en.Latitude), lng: Number(en.Longitude)});
		}
	});

	formattedLocA = {lat: Number(locA.lat), lng: Number(locA.long)};

	findShortestPath(formattedLocA, currentBuildingEntrances, function(start, end) {
		console.log(start);
		map.setCenter(start);
		var request = {
			origin:start,
			destination:end,
			travelMode: google.maps.TravelMode.WALKING
		};
		directionsService.route(request, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
			    // 
			    //console.log(response);
			    polyline.setPath([]);
			    directionsDisplay.setDirections(response);
			    var legs = response.routes[0].legs;
			    for (i=0;i<legs.length;i++) {
			    	var steps = legs[i].steps;
			    	for (j=0;j<steps.length;j++) {
			    		var nextSegment = steps[j].path;
			    		for (k=0;k<nextSegment.length;k++) {
			    			polyline.getPath().push(nextSegment[k]);
			    			bounds.extend(nextSegment[k]);
			    		}
			    	}
			    }

			    polyline.setMap(map);
			    map.fitBounds(bounds);
			}
		});
	});
}

function findShortestPath(startLocation, destLocations, drawRouteCallback)
{
	distanceService.getDistanceMatrix(
	{
		origins: [startLocation],
		destinations: destLocations,
		travelMode: google.maps.TravelMode.WALKING,
		unitSystem: google.maps.UnitSystem.IMPERIAL,
	}, function(response, status){
		infoOnRoutes = response.rows[0].elements;

		var shortestRouteIndex;
		//Should be largest integer
		var shortestRouteDistance = 9999999999;

		console.log(infoOnRoutes);
		for (var i = 0; i < infoOnRoutes.length; i++) {
			if (infoOnRoutes[i].distance.value < shortestRouteDistance) {
				shortestRouteDistance = infoOnRoutes[i].distance.value;
				shortestRouteIndex = i;
			}
		}

		var closestEntrance = destLocations[shortestRouteIndex];
		drawRouteCallback(startLocation, closestEntrance);
	});
}

function finalizeDistances(response)
{
	callbackCounter += 1;
	callbackDistances.push(response)
// var shortestLoc = 
if (callbackCounter == callbackMAX){
	var shortestDist = callbackDistances[0];
	callbackDistances.forEach(function(distance){
		if(callbackDistances < shortestDist)
		{
			shortestDist = distance;
		}
	});

	console.log("shortest distance: " + shortestDist);
	callbackCounter = 0;
	callbackDistances = [];

}

}








